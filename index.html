<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Streamer OS - Live</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="bg" class="bg-gif"></div>
    <div class="crt-overlay"></div>

    <div class="main-layout">
        <aside class="side-panel">
            <div class="panel-header">SCHEDULE_LOG</div>
            <div id="schedule-list">
                <div class="item">LUNDI : 21H00</div>
                <div class="item">MARDI : 21H00</div>
                <div class="item">MERCREDI : --</div>
                <div class="item">JEUDI : 21H00</div>
                <div class="item">VENDREDI : 21H00</div>
                <div class="item">WEEKEND : 14H00</div>
            </div>
        </aside>

        <main class="terminal">
            <header>
                <img id="pfp" src="https://api.dicebear.com/7.x/pixel-art/svg?seed=Lucky" class="avatar-pixel">
                <h1 id="title">> RECRUE_ERROR</h1>
                <div id="status-live" class="status-badge offline">OFFLINE</div>
            </header>
            <div style="margin: 15px 0;">
                <p id="bio-text">Système en attente de configuration...</p>
            </div>
            <nav>
                <a id="twitch-link" href="#" class="btn">ACCÉDER AU LIVE</a>
                <a id="discord-link" href="#" class="btn">REJOINDRE LE DISCORD</a>
            </nav>
        </main>

        <aside class="side-panel">
            <div class="panel-header">CURRENT_GAMES</div>
            <div id="games-list">
                <div class="item">Aucun jeu listé</div>
            </div>
        </aside>
    </div>

    <script>
        async function syncData() {
            const user = localStorage.getItem('twitch_user');
            const cid = localStorage.getItem('twitch_client');
            const token = localStorage.getItem('twitch_token');
            const bg = localStorage.getItem('user_bg');
            const games = localStorage.getItem('user_games');

            // 1. Appliquer les réglages visuels
            if(bg) document.body.style.backgroundImage = `url('${bg}')`;
            if(user) document.getElementById('title').innerText = "> " + user.toUpperCase();
            document.getElementById('bio-text').innerText = localStorage.getItem('user_bio') || "Bienvenue sur mon espace.";
            document.getElementById('discord-link').href = localStorage.getItem('user_discord') || "#";
            document.getElementById('twitch-link').href = "https://twitch.tv/" + (user || "");

            // 2. Gérer la liste des jeux
            if(games) {
                const gamesDiv = document.getElementById('games-list');
                gamesDiv.innerHTML = games.split(',').map(g => `<div class="item">${g.trim()}</div>`).join('');
            }

            // 3. Appel API Twitch (si configuré)
            if (user && cid && token) {
                try {
                    const uRes = await fetch(`https://api.twitch.tv/helix/users?login=${user}`, {
                        headers: { 'Client-ID': cid, 'Authorization': `Bearer ${token}` }
                    });
                    const uData = await uRes.json();
                    if(uData.data[0]) document.getElementById('pfp').src = uData.data[0].profile_image_url;

                    const sRes = await fetch(`https://api.twitch.tv/helix/streams?user_login=${user}`, {
                        headers: { 'Client-ID': cid, 'Authorization': `Bearer ${token}` }
                    });
                    const sData = await sRes.json();
                    const badge = document.getElementById('status-live');
                    if(sData.data.length > 0) {
                        badge.innerText = "STATUS: LIVE NOW";
                        badge.className = "status-badge online";
                    } else {
                        badge.innerText = "OFFLINE";
                        badge.className = "status-badge offline";
                    }
                } catch(e) { console.log("Twitch API Offline"); }
            }
        }
        syncData();
        setInterval(syncData, 60000);
    </script>
</body>
</html>
