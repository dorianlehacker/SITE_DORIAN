<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Streamer OS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="crt-overlay"></div>
    <div class="terminal">
        <img id="pfp" src="" class="avatar-pixel" alt="Avatar">
        <h1 id="title">> CHARGEMENT...</h1>
        <p id="bio-text"></p>
        <div id="status-live" class="status-badge offline">OFFLINE</div>
        
        <nav style="margin-top: 20px;">
            <a id="twitch-link" href="#" class="btn">> VOIR LE LIVE</a>
            <a id="discord-link" href="#" class="btn">> DISCORD</a>
        </nav>
    </div>

    <script>
        async function init() {
            const user = localStorage.getItem('twitch_user');
            const cid = localStorage.getItem('twitch_client');
            const token = localStorage.getItem('twitch_token');
            const bg = localStorage.getItem('user_bg');

            // Appliquer le fond d'Ã©cran
            if(bg) document.body.style.backgroundImage = `url('${bg}')`;
            
            // Appliquer Bio et Discord
            document.getElementById('bio-text').innerText = localStorage.getItem('user_bio') || "";
            document.getElementById('discord-link').href = localStorage.getItem('user_discord') || "#";

            if (!user || !cid || !token) {
                document.getElementById('title').innerText = "> CONFIG MANQUANTE";
                return;
            }

            try {
                // Info utilisateur
                const uRes = await fetch(`https://api.twitch.tv/helix/users?login=${user}`, {
                    headers: { 'Client-ID': cid, 'Authorization': `Bearer ${token}` }
                });
                const uData = await uRes.json();
                if(uData.data[0]) {
                    document.getElementById('pfp').src = uData.data[0].profile_image_url;
                    document.getElementById('title').innerText = "> " + uData.data[0].display_name.toUpperCase();
                    document.getElementById('twitch-link').href = "https://twitch.tv/" + user;
                }

                // Statut Live
                const sRes = await fetch(`https://api.twitch.tv/helix/streams?user_login=${user}`, {
                    headers: { 'Client-ID': cid, 'Authorization': `Bearer ${token}` }
                });
                const sData = await sRes.json();
                const badge = document.getElementById('status-live');
                if(sData.data.length > 0) {
                    badge.innerText = "STATUS: LIVE NOW";
                    badge.className = "status-badge online";
                }
            } catch(e) { console.error(e); }
        }
        init();
        setInterval(init, 60000);
    </script>
</body>
</html>
